<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Editor de Conte√∫do - Portal PSR</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìù</text></svg>">
    
    <style>
        :root { 
            --primary: #003366; --bg: #f4f7f9; --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            padding: 20px; color: #333; margin: 0; padding-bottom: 120px;
        }

        /* ESTADOS DE VISUALIZA√á√ÉO */
        #app-content { display: none; } /* Oculto por padr√£o */
        
        /* TELA DE LOGIN (NOVO) */
        #login-screen {
            display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 9999;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
            backdrop-filter: blur(5px);
        }
        
        /* TELA DE ACESSO NEGADO */
        #access-denied {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1a1a1a; color: #fff; z-index: 10000;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        .btn-login-google {
            background: white; color: #444; border: 1px solid #ddd;
            padding: 15px 30px; font-size: 1.1em; font-weight: 600;
            border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .btn-login-google:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .btn-login-google img { width: 24px; height: 24px; }

        /* REAPROVEITAMENTO DO ESTILO ANTERIOR PARA O EDITOR */
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { 
            color: var(--primary); margin: 0 0 20px 0; font-size: 2.5em;
            background: linear-gradient(135deg, var(--primary) 0%, #004d99 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .view-switcher { 
            display: flex; justify-content: center; gap: 12px; margin-bottom: 35px;
            background: white; padding: 10px; border-radius: 50px;
            box-shadow: var(--shadow-md); width: fit-content; margin-left: auto; margin-right: auto;
            flex-wrap: wrap;
        }
        .view-btn { 
            text-decoration: none; border: none; background: transparent; 
            padding: 12px 24px; border-radius: 25px; cursor: pointer; 
            font-weight: 600; color: #777; transition: var(--transition); 
            display: flex; align-items: center; gap: 8px; font-size: 0.9em;
        }
        .view-btn.active { 
            background: var(--primary); color: white; 
            box-shadow: 0 6px 16px rgba(0,51,102,0.25); transform: translateY(-2px);
        }
        
        .dashboard-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 25px; max-width: 1400px; margin: 0 auto; 
        }
        .card { 
            background: white; padding: 28px; border-radius: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-direction: column; 
            position: relative; border-top: 4px solid var(--primary);
            transition: var(--transition);
        }
        .card-header { 
            display: flex; align-items: center; justify-content: space-between; 
            border-bottom: 2px solid #f0f0f0; padding-bottom: 12px; margin-bottom: 22px; 
        }
        .card h2 { margin: 0; color: var(--primary); font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        
        .form-group { margin-bottom: 18px; width: 100%; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 7px; font-size: 0.85em; color: #555; text-transform: uppercase; }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; padding: 12px 14px; border: 2px solid #e0e0e0; 
            border-radius: 8px; font-family: inherit; font-size: 0.9em; background: #fafafa;
        }
        
        .tab-nav { display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #eee; }
        .tab-btn { padding: 10px 20px; background: none; border: none; font-weight: 600; color: #777; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tags-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

        .actions-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 100; }
        .btn-action { padding: 16px 40px; border-radius: 50px; border: none; font-size: 1.1em; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        .btn-save { background: linear-gradient(135deg, var(--primary) 0%, #004d99 100%); }
        .btn-clear { background: #dc3545; }

        .cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .client-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; align-items: center; }
        .client-remove { background: #ffe5e5; border: 1px solid #ffcccc; color: #dc3545; width: 34px; height: 34px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-add-client { width: 100%; padding: 12px; background: #f0f4f8; border: 2px dashed #cedae6; color: var(--primary); cursor: pointer; border-radius: 8px; font-weight: 600; margin-top: 10px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div style="margin-bottom: 30px;">
        <i class="fas fa-lock fa-3x" style="color:var(--primary); margin-bottom: 20px;"></i>
        <h2 style="color:var(--primary); margin:0;">√Årea Restrita</h2>
        <p style="color:#666;">Fa√ßa login para gerenciar o conte√∫do</p>
    </div>
    <button class="btn-login-google" onclick="performLogin()">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/1280px-Google_%22G%22_logo.svg.png" alt="G">
        Entrar com Google
    </button>
</div>

<div id="access-denied">
    <h1><i class="fas fa-ban"></i> Acesso Negado</h1>
    <p>Este e-mail n√£o tem permiss√£o para acessar o painel.</p>
    <button onclick="performLogout()" style="margin-top:30px; padding:10px 20px; cursor:pointer; background:transparent; border:1px solid #666; color:#aaa; border-radius:5px;">Voltar / Trocar Conta</button>
</div>

<div id="app-content">
    <div class="header">
        <h1>Painel PSR</h1>
        <div class="view-switcher">
            <a href="editor.html" class="view-btn active"><i class="fas fa-edit"></i> Editor</a>
            <a href="interacoes.html" class="view-btn"><i class="fas fa-chart-line"></i> Intera√ß√µes</a>
            <a href="trafego_interno.html" class="view-btn"><i class="fas fa-network-wired"></i> Tr√°fego Conex√£oPSR</a>
            <a href="trafego_portal.html" class="view-btn"><i class="fas fa-globe"></i> Tr√°fego Portal</a>
        </div>
    </div>

    <form id="dashboardForm" onsubmit="event.preventDefault(); confirmSave();">
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header"><h2><i class="fas fa-calendar-alt"></i> Tema do M√™s</h2></div>
                <div class="form-group"><label>T√≠tulo:</label><input type="text" id="tema-titulo"></div>
                <div class="form-group"><label>Subt√≠tulo:</label><input type="text" id="tema-subtitulo"></div>
                <div class="form-group"><label>CAPA URL:</label><input type="text" id="tema-capa"></div>
                <div class="form-group"><label>√çcone (Emoji):</label><input type="text" id="tema-icon"></div>
                <div class="form-group"><label>Resumo:</label><textarea id="tema-resumo" rows="3"></textarea></div>
                <div class="form-group"><label>Conte√∫do HTML:</label><textarea id="tema-conteudo" rows="6"></textarea></div>
                <div class="cols-2">
                    <div class="form-group"><label>Fonte Nome:</label><input type="text" id="tema-fonte-nome"></div>
                    <div class="form-group"><label>Fonte Link:</label><input type="text" id="tema-fonte-link"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-lightbulb"></i> Partiu Pensar</h2></div>
                <div class="form-group"><label>T√≠tulo:</label><input type="text" id="pp-titulo"></div>
                <div class="form-group"><label>Subt√≠tulo:</label><input type="text" id="pp-subtitulo"></div>
                <div class="form-group"><label>Imagem Fundo:</label><input type="text" id="pp-bg"></div>
                <div class="form-group"><label>Resumo:</label><textarea id="pp-resumo" rows="2"></textarea></div>
                <div class="form-group"><label>Conte√∫do HTML:</label><textarea id="pp-conteudo" rows="5"></textarea></div>
                <div class="form-group"><label>Autor:</label><input type="text" id="pp-fonte"></div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-heartbeat"></i> Bem-Estar</h2></div>
                <div class="form-group"><label>Subt√≠tulo:</label><input type="text" id="saude-subtitulo"></div>
                <div class="form-group"><label>Imagem Fundo:</label><input type="text" id="saude-bg"></div> <div class="form-group"><label>√çcone (Emoji):</label><input type="text" id="saude-icon"></div> <div class="form-group"><label>Resumo:</label><textarea id="saude-resumo" rows="3"></textarea></div>
                <div class="form-group"><label>Conte√∫do HTML:</label><textarea id="saude-conteudo" rows="6"></textarea></div>
                <div class="form-group"><label>Link:</label><input type="text" id="saude-link"></div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-film"></i> Indica A√≠</h2></div>
                <div class="tab-nav">
                    <button type="button" class="tab-btn active" onclick="switchTab('cultura-video', this)">üé• V√≠deo</button>
                    <button type="button" class="tab-btn" onclick="switchTab('cultura-livro', this)">üìö Livro</button>
                </div>
                <div id="cultura-video" class="tab-content active">
                    <div class="form-group"><label>T√≠tulo:</label><input type="text" id="cultura-0-titulo"></div>
                    <div class="form-group"><label>Link:</label><input type="text" id="cultura-0-link"></div>
                    <div class="form-group"><label>Capa URL:</label><input type="text" id="cultura-0-img"></div>
                    <div class="form-group"><label>Indicado Por:</label><input type="text" id="cultura-0-indicado"></div>
                    <div class="form-group"><label>Sinopse:</label><textarea id="cultura-0-sinopse"></textarea></div>
                    <div class="form-group"><label>Categoria:</label><input type="text" id="cultura-0-tag"></div>
                </div>
                <div id="cultura-livro" class="tab-content">
                    <div class="form-group"><label>T√≠tulo:</label><input type="text" id="cultura-1-titulo"></div>
                    <div class="form-group"><label>Link:</label><input type="text" id="cultura-1-link"></div>
                    <div class="form-group"><label>Capa URL:</label><input type="text" id="cultura-1-img"></div>
                    <div class="form-group"><label>Indicado Por:</label><input type="text" id="cultura-1-indicado"></div>
                    <div class="form-group"><label>Sinopse:</label><textarea id="cultura-1-sinopse"></textarea></div>
                    <div class="form-group"><label>Categoria:</label><input type="text" id="cultura-1-tag"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-user-circle"></i> Hobby</h2></div>
                <div class="form-group"><label>Nome:</label><input type="text" id="hobby-nome"></div>
                <div class="form-group"><label>Cargo:</label><input type="text" id="hobby-cargo"></div>
                <div class="form-group"><label>Foto URL:</label><input type="text" id="hobby-foto"></div>
                <div class="form-group"><label>Texto:</label><textarea id="hobby-texto" rows="4"></textarea></div>
                <div class="form-group"><label>Tags:</label>
                    <div class="tags-grid">
                        <input type="text" id="tag-1" placeholder="Tag 1">
                        <input type="text" id="tag-2" placeholder="Tag 2">
                        <input type="text" id="tag-3" placeholder="Tag 3">
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-dumbbell"></i> Desafios do M√™s</h2></div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e0e0e0;">
                    <h4 style="margin: 0 0 10px 0; color: var(--primary); font-size: 0.9em; text-transform: uppercase;"><i class="fas fa-tint"></i> Slot 1 (Padr√£o: Hidrata√ß√£o)</h4>
                    <div class="cols-2">
                        <div class="form-group"><label>Emoji:</label><input type="text" id="desafio-0-emoji" placeholder="üíß"></div>
                        <div class="form-group"><label>T√≠tulo:</label><input type="text" id="desafio-0-titulo" placeholder="Hidrata√ß√£o"></div>
                    </div>
                    <div class="form-group"><label>Descri√ß√£o (Meta):</label><input type="text" id="desafio-0-desc" placeholder="Ex: Beba 2 litros de √°gua"></div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #e0e0e0;">
                    <h4 style="margin: 0 0 10px 0; color: var(--primary); font-size: 0.9em; text-transform: uppercase;"><i class="fas fa-walking"></i> Slot 2 (Padr√£o: Passos)</h4>
                    <div class="cols-2">
                        <div class="form-group"><label>Emoji:</label><input type="text" id="desafio-1-emoji" placeholder="üö∂"></div>
                        <div class="form-group"><label>T√≠tulo:</label><input type="text" id="desafio-1-titulo" placeholder="10 Mil Passos"></div>
                    </div>
                    <div class="form-group"><label>Descri√ß√£o (Meta):</label><input type="text" id="desafio-1-desc" placeholder="Ex: Caminhe 10 mil passos di√°rios"></div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0;">
                    <h4 style="margin: 0 0 10px 0; color: var(--primary); font-size: 0.9em; text-transform: uppercase;"><i class="fas fa-bed"></i> Slot 3 (Padr√£o: Sono)</h4>
                    <div class="cols-2">
                        <div class="form-group"><label>Emoji:</label><input type="text" id="desafio-2-emoji" placeholder="üò¥"></div>
                        <div class="form-group"><label>T√≠tulo:</label><input type="text" id="desafio-2-titulo" placeholder="Sono de Qualidade"></div>
                    </div>
                    <div class="form-group"><label>Descri√ß√£o (Meta):</label><input type="text" id="desafio-2-desc" placeholder="Ex: Tente dormir 8 horas por noite"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-briefcase"></i> Novos Clientes</h2>
                    <button type="button" class="client-remove" onclick="document.getElementById('clientes-list').innerHTML=''; addNewClientRow();"><i class="fas fa-trash"></i></button>
                </div>
                <div class="cols-2">
                    <div class="form-group"><label>Qtd:</label><input type="text" id="clientes-qtd"></div>
                    <div class="form-group"><label>Per√≠odo:</label><input type="text" id="clientes-periodo"></div>
                </div>
                <div id="clientes-list" style="margin-top:10px;"></div>
                <button type="button" class="btn-add-client" onclick="addNewClientRow()">+ Linha</button>
            </div>
        </div>
    </form>

    <div class="actions-bar">
        <button class="btn-action btn-clear" onclick="clearForm()"><i class="fas fa-eraser"></i> Limpar</button>
        <button class="btn-action btn-save" onclick="confirmSave()"><i class="fas fa-save"></i> PUBLICAR</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyBzMvAw9ahEyd-tSYY08HxcMzo9RKf3IFY", authDomain: "jornalpsr-1b8c6.firebaseapp.com", databaseURL: "https://jornalpsr-1b8c6-default-rtdb.firebaseio.com", projectId: "jornalpsr-1b8c6" };
    firebase.initializeApp(firebaseConfig);
    
    let AUTH_TOKEN = null;
    const CONTENT_URL = "https://jornalpsr-1b8c6-default-rtdb.firebaseio.com/content.json";
    const CATEGORIES_MAP = { "A√ßougues": "ü•©", "Restaurantes": "üçΩÔ∏è", "Ind√∫stria": "üè≠", "Transporte": "üöö", "Com√©rcio": "üè™", "Servi√ßos": "üíº", "Outros": "üè¢", "Farm√°cias": "üíä", "E-commerce": "üì¶", "Automotivo": "üöó", "T√™xtil": "üëï" };
    
    // --- SEGURAN√áA ---
    const ALLOWED_EMAILS = ["marketingpsrimpressao@gmail.com", "rohsantos1@gmail.com"];
    // REMOVIDO ONE_WEEK_MS para evitar logout indesejado

    // Monitora estado (Login/Logout)
    firebase.auth().onAuthStateChanged(async user => {
        if (user) {
            // USU√ÅRIO LOGADO
            if (ALLOWED_EMAILS.includes(user.email)) {
                // E-mail PERMITIDO
                
                // ATUALIZA TIMESTAMP AUTOMATICAMENTE AO CARREGAR (Corre√ß√£o do Login Chato)
                localStorage.setItem('secure_last_login_ts', Date.now());

                // Tudo OK: Esconde Login, Mostra App
                user.getIdToken().then(token => { 
                    AUTH_TOKEN = token;
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('access-denied').style.display = 'none';
                    document.getElementById('app-content').style.display = 'block';
                    loadContent(); 
                });

            } else {
                // E-mail N√ÉO PERMITIDO
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-content').style.display = 'none';
                document.getElementById('access-denied').style.display = 'flex';
                firebase.auth().signOut(); // Desloga o intruso
            }
        } else {
            // USU√ÅRIO N√ÉO LOGADO
            document.getElementById('app-content').style.display = 'none';
            document.getElementById('access-denied').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex'; // Mostra bot√£o de login
        }
    });

    // Fun√ß√£o manual chamada pelo bot√£o (EVITA BLOQUEIO DE POPUP)
    function performLogin() {
        firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())
            .then((result) => {
                const email = result.user.email;
                if (ALLOWED_EMAILS.includes(email)) {
                    // Login novo com sucesso
                    localStorage.setItem('secure_last_login_ts', Date.now());
                }
                // O onAuthStateChanged vai lidar com o resto
            })
            .catch((error) => {
                console.error(error);
                alert("Erro ao logar: " + error.message);
            });
    }

    function performLogout() {
        firebase.auth().signOut().then(() => {
            window.location.reload();
        });
    }
    // -----------------

    // --- FUN√á√ïES DO EDITOR ---
    function switchTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function clearForm() {
        if(!confirm("Tem certeza?")) return;
        document.querySelectorAll('input, textarea').forEach(el => el.value = '');
        document.getElementById('clientes-list').innerHTML = '';
        addNewClientRow();
    }

    async function loadContent() {
        try {
            const resp = await fetch(CONTENT_URL + "?auth=" + AUTH_TOKEN);
            const data = await resp.json();
            if(!data) return;

            // Preenchimento
            setVal('tema-titulo', data.temaMes?.titulo);
            setVal('tema-subtitulo', data.temaMes?.subtitulo);
            setVal('tema-resumo', data.temaMes?.resumo);
            setVal('tema-conteudo', data.temaMes?.conteudoCompleto);
            setVal('tema-fonte-nome', data.temaMes?.fonte?.texto);
            setVal('tema-fonte-link', data.temaMes?.fonte?.link);
            setVal('tema-capa', data.temaMes?.capaUrl);
            setVal('tema-icon', data.temaMes?.icon); // NOVO

            setVal('pp-titulo', data.partiuPensar?.titulo);
            setVal('pp-subtitulo', data.partiuPensar?.subtitulo);
            setVal('pp-bg', data.partiuPensar?.imagemFundo);
            setVal('pp-resumo', data.partiuPensar?.resumo);
            setVal('pp-conteudo', data.partiuPensar?.conteudoCompleto);
            setVal('pp-fonte', data.partiuPensar?.fonte);

            setVal('saude-subtitulo', data.saudeFisica?.subtitulo);
            setVal('saude-bg', data.saudeFisica?.imagemFundo); // NOVO
            setVal('saude-icon', data.saudeFisica?.icon); // NOVO
            setVal('saude-resumo', data.saudeFisica?.resumo);
            setVal('saude-conteudo', data.saudeFisica?.conteudoCompleto);
            setVal('saude-link', data.saudeFisica?.fonte?.link);

            if(data.cultura) {
                data.cultura.forEach((item, i) => {
                    if(i>1) return;
                    setVal(`cultura-${i}-titulo`, item.titulo);
                    setVal(`cultura-${i}-link`, item.link);
                    setVal(`cultura-${i}-img`, item.img);
                    setVal(`cultura-${i}-indicado`, item.indicadoPor);
                    setVal(`cultura-${i}-sinopse`, item.sinopse);
                    setVal(`cultura-${i}-tag`, item.tag); // NOVO
                });
            }

            if(data.hobby) {
                setVal('hobby-nome', data.hobby.nome);
                setVal('hobby-cargo', data.hobby.cargo);
                setVal('hobby-foto', data.hobby.foto);
                setVal('hobby-texto', data.hobby.texto);
                let tags = data.hobby.tags || [];
                if (typeof tags === 'string') tags = tags.split(',').map(t=>t.trim());
                setVal('tag-1', tags[0] || '');
                setVal('tag-2', tags[1] || '');
                setVal('tag-3', tags[2] || '');
            }

            // Carregar Desafios (NOVO)
            if(data.desafios) {
                data.desafios.forEach((d, i) => {
                    if(i > 2) return;
                    setVal(`desafio-${i}-emoji`, d.emoji);
                    setVal(`desafio-${i}-titulo`, d.titulo);
                    setVal(`desafio-${i}-desc`, d.desc);
                });
            } else {
                setVal('desafio-0-emoji', 'üíß'); setVal('desafio-0-titulo', 'Hidrata√ß√£o'); setVal('desafio-0-desc', 'Beba 2 litros de √°gua por dia.');
                setVal('desafio-1-emoji', 'üö∂'); setVal('desafio-1-titulo', '10 Mil Passos'); setVal('desafio-1-desc', 'Caminhe 10 mil passos di√°rios.');
                setVal('desafio-2-emoji', 'üò¥'); setVal('desafio-2-titulo', 'Sono de Qualidade'); setVal('desafio-2-desc', 'Tente dormir 8 horas por noite.');
            }

            if(data.novos_clientes) {
                setVal('clientes-qtd', data.novos_clientes.resumo?.quantidade);
                setVal('clientes-periodo', data.novos_clientes.resumo?.periodo);
                const list = document.getElementById('clientes-list');
                list.innerHTML = '';
                if(data.novos_clientes.lista) {
                    data.novos_clientes.lista.forEach(c => {
                        let catKey = Object.keys(CATEGORIES_MAP).find(k => CATEGORIES_MAP[k] === c.icone) || "Outros";
                        addNewClientRow(catKey, c.nome);
                    });
                } else {
                    addNewClientRow();
                }
            }
        } catch(e) { console.error(e); }
    }

    async function confirmSave() {
        if(!confirm("Publicar altera√ß√µes?")) return;
        
        let currentData = {};
        try {
            const resp = await fetch(CONTENT_URL + "?auth=" + AUTH_TOKEN);
            currentData = await resp.json() || {};
        } catch(e) {}

        const tagsArray = [getVal('tag-1'), getVal('tag-2'), getVal('tag-3')].filter(t => t.trim() !== "");

        const data = {
            temaMes: {
                titulo: getVal('tema-titulo'),
                subtitulo: getVal('tema-subtitulo'),
                resumo: getVal('tema-resumo'),
                conteudoCompleto: getVal('tema-conteudo'),
                capaUrl: getVal('tema-capa'),
                icon: getVal('tema-icon'), // NOVO
                fonte: { texto: getVal('tema-fonte-nome'), link: getVal('tema-fonte-link') }
            },
            partiuPensar: {
                titulo: getVal('pp-titulo'),
                subtitulo: getVal('pp-subtitulo'),
                imagemFundo: getVal('pp-bg'),
                resumo: getVal('pp-resumo'),
                conteudoCompleto: getVal('pp-conteudo'),
                fonte: getVal('pp-fonte')
            },
            saudeFisica: {
                subtitulo: getVal('saude-subtitulo'),
                imagemFundo: getVal('saude-bg'), // NOVO
                icon: getVal('saude-icon'), // NOVO
                resumo: getVal('saude-resumo'),
                conteudoCompleto: getVal('saude-conteudo'),
                fonte: { link: getVal('saude-link'), texto: "Fonte" }
            },
            cultura: [
                { id: "filme_mes", tipo: "video", titulo: getVal('cultura-0-titulo'), link: getVal('cultura-0-link'), img: getVal('cultura-0-img'), indicadoPor: getVal('cultura-0-indicado'), sinopse: getVal('cultura-0-sinopse'), tag: getVal('cultura-0-tag') }, // NOVO TAG
                { id: "livro_mes", tipo: "livro", titulo: getVal('cultura-1-titulo'), link: getVal('cultura-1-link'), img: getVal('cultura-1-img'), indicadoPor: getVal('cultura-1-indicado'), sinopse: getVal('cultura-1-sinopse'), tag: getVal('cultura-1-tag') } // NOVO TAG
            ],
            hobby: {
                nome: getVal('hobby-nome'),
                cargo: getVal('hobby-cargo'),
                foto: getVal('hobby-foto'),
                texto: getVal('hobby-texto'),
                tags: tagsArray
            },
            receitas: currentData.receitas || [], 
            
            novos_clientes: {
                resumo: { quantidade: getVal('clientes-qtd'), periodo: getVal('clientes-periodo') },
                lista: Array.from(document.querySelectorAll('.client-row')).map(row => ({
                    icone: CATEGORIES_MAP[row.querySelector('select').value] || "üè¢",
                    nome: row.querySelector('input').value,
                    destaque: false, data: ""
                })).filter(c => c.nome)
            },
            
            // DESAFIOS (ATUALIZADO)
            desafios: [
                {
                    id: "hidratacao",
                    emoji: getVal('desafio-0-emoji') || "üíß",
                    titulo: getVal('desafio-0-titulo') || "Hidrata√ß√£o",
                    desc: getVal('desafio-0-desc') || "Beba √°gua"
                },
                {
                    id: "passos",
                    emoji: getVal('desafio-1-emoji') || "üö∂",
                    titulo: getVal('desafio-1-titulo') || "Caminhada",
                    desc: getVal('desafio-1-desc') || "Caminhe todo dia"
                },
                {
                    id: "sono",
                    emoji: getVal('desafio-2-emoji') || "üò¥",
                    titulo: getVal('desafio-2-titulo') || "Sono",
                    desc: getVal('desafio-2-desc') || "Durma bem"
                }
            ],

            sustentabilidade: currentData.sustentabilidade || {}
        };

        try {
            await fetch(CONTENT_URL + "?auth=" + AUTH_TOKEN, { method: 'PUT', body: JSON.stringify(data) });
            alert("Sucesso!");
        } catch(e) { alert("Erro: " + e.message); }
    }

    function addNewClientRow(cat="", name="") {
        const div = document.createElement('div'); div.className = 'client-row';
        let options = ''; 
        for(let k in CATEGORIES_MAP) options += `<option value="${k}" ${k===cat?'selected':''}>${k}</option>`;
        div.innerHTML = `<select class="client-select" style="padding:10px; border-radius:8px; border:2px solid #ddd;">${options}</select><div style="display:flex;gap:5px;width:100%"><input type="text" value="${name}" class="client-input"><button type="button" class="client-remove" onclick="this.closest('.client-row').remove()"><i class="fas fa-trash"></i></button></div>`;
        document.getElementById('clientes-list').appendChild(div);
    }

    document.getElementById('clientes-list').addEventListener('paste', e => {
        if(!e.target.classList.contains('client-input')) return;
        const text = (e.clipboardData || window.clipboardData).getData('text');
        if(!text.includes('\n')) return;
        e.preventDefault();
        const lines = text.split(/\r?\n/).filter(l=>l.trim());
        const cat = e.target.closest('.client-row').querySelector('select').value;
        e.target.value = lines[0];
        for(let i=1; i<lines.length; i++) addNewClientRow(cat, lines[i]);
    });

    function getVal(id) { return document.getElementById(id)?.value || ""; }
    function setVal(id, v) { if(document.getElementById(id)) document.getElementById(id).value = v || ""; }
</script>
</body>
</html>
