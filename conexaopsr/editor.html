<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Editor de Conte√∫do - Portal PSR</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìù</text></svg>">
    
    <style>
        :root { 
            --primary: #003366; --accent: #DAA520; --bg: #f4f7f9; --success: #28a745; --danger: #dc3545;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06); --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            padding: 20px; color: #333; margin: 0; padding-bottom: 120px;
        }

        /* SEGURAN√áA VISUAL: Esconde tudo at√© logar */
        #app-content { display: none; }

        /* TELA DE ACESSO NEGADO */
        #access-denied {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: #fff; z-index: 10000;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        #access-denied h1 { color: #dc3545; font-size: 3em; margin-bottom: 10px; }
        #access-denied p { font-size: 1.2em; color: #aaa; }

        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { 
            color: var(--primary); margin: 0 0 20px 0; font-size: 2.5em;
            background: linear-gradient(135deg, var(--primary) 0%, #004d99 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* MENU DE NAVEGA√á√ÉO */
        .view-switcher { 
            display: flex; justify-content: center; gap: 12px; margin-bottom: 35px;
            background: white; padding: 10px; border-radius: 50px;
            box-shadow: var(--shadow-md); width: fit-content; margin-left: auto; margin-right: auto;
            flex-wrap: wrap;
        }
        .view-btn { 
            text-decoration: none; border: none; background: transparent; 
            padding: 12px 24px; border-radius: 25px; cursor: pointer; 
            font-weight: 600; color: #777; transition: var(--transition); 
            display: flex; align-items: center; gap: 8px; font-size: 0.9em;
        }
        .view-btn.active { 
            background: var(--primary); color: white; 
            box-shadow: 0 6px 16px rgba(0,51,102,0.25); transform: translateY(-2px);
        }
        .view-btn:hover:not(.active) { background: rgba(0,51,102,0.05); }

        /* GRID E CARDS */
        .dashboard-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 25px; max-width: 1400px; margin: 0 auto; 
        }
        .card { 
            background: white; padding: 28px; border-radius: 16px; 
            box-shadow: var(--shadow-sm); display: flex; flex-direction: column; 
            position: relative; border-top: 4px solid var(--primary);
            transition: var(--transition);
        }
        .card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
        
        .card-header { 
            display: flex; align-items: center; justify-content: space-between; 
            border-bottom: 2px solid #f0f0f0; padding-bottom: 12px; margin-bottom: 22px; 
        }
        .card h2 { 
            margin: 0; color: var(--primary); font-size: 1.2em; 
            display: flex; align-items: center; gap: 10px; 
        }
        
        /* FORMUL√ÅRIOS */
        .form-group { margin-bottom: 18px; width: 100%; }
        .form-group label { 
            display: block; font-weight: 600; margin-bottom: 7px; 
            font-size: 0.85em; color: #555; text-transform: uppercase; 
        }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; padding: 12px 14px; border: 2px solid #e0e0e0; 
            border-radius: 8px; font-family: inherit; font-size: 0.9em; 
            background: #fafafa; transition: 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus { 
            border-color: var(--primary); outline: none; background: white; 
            box-shadow: 0 0 0 3px rgba(0,51,102,0.1);
        }
        
        /* ABAS (TABS) PARA CULTURA */
        .tab-nav {
            display: flex; gap: 5px; margin-bottom: 15px; border-bottom: 2px solid #eee;
        }
        .tab-btn {
            padding: 10px 20px; background: none; border: none; font-weight: 600;
            color: #777; cursor: pointer; border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab-btn:hover { color: var(--primary); background: #f8f9fa; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        /* TAGS EM 3 COLUNAS */
        .tags-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
        }

        /* ACTIONS BAR (BOTOES FLUTUANTES) */
        .actions-bar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; z-index: 100;
        }

        .btn-action { 
            padding: 16px 40px; border-radius: 50px; border: none;
            font-size: 1.1em; font-weight: bold; cursor: pointer; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); 
            transition: transform 0.3s; display: flex; align-items: center; gap: 10px;
            color: white;
        }
        .btn-action:hover { transform: translateY(-5px); }
        
        .btn-save { background: linear-gradient(135deg, var(--primary) 0%, #004d99 100%); }
        .btn-clear { background: #dc3545; font-size: 1em; padding: 16px 30px; }

        /* UTILIT√ÅRIOS */
        .cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .client-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; align-items: center; }
        
        .client-remove { 
            background: #ffe5e5; border: 1px solid #ffcccc; color: #dc3545; 
            width: 34px; height: 34px; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            transition: 0.2s;
        }
        .client-remove:hover { background: #dc3545; color: white; }

        .btn-add-client { 
            width: 100%; padding: 12px; background: #f0f4f8; 
            border: 2px dashed #cedae6; color: var(--primary); 
            cursor: pointer; border-radius: 8px; font-weight: 600; margin-top: 10px;
            transition: 0.2s;
        }
        .btn-add-client:hover { background: #e1e8ef; border-color: var(--primary); }
        
        /* Loading Overlay */
        #loading { 
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background:rgba(255,255,255,1); z-index:9999; 
            display:flex; justify-content:center; align-items:center; flex-direction:column;
            backdrop-filter: blur(5px);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="access-denied">
    <h1><i class="fas fa-lock"></i> Acesso Negado</h1>
    <p>Voc√™ n√£o tem permiss√£o para acessar este sistema.</p>
    <p style="font-size:0.9em; margin-top:20px;">IP e Tentativa Registrados.</p>
    <button onclick="logoutAndReload()" style="margin-top:20px; padding:10px 20px; cursor:pointer;">Tentar outra conta</button>
</div>

<div id="loading"><div><i class="fas fa-shield-alt fa-3x" style="color:var(--primary)"></i></div><h3 style="color:var(--primary); margin-top:15px;">Verificando Credenciais...</h3></div>

<div id="app-content">
    <div class="header">
        <h1>Painel PSR</h1>
        <div class="view-switcher">
            <a href="editor.html" class="view-btn active"><i class="fas fa-edit"></i> Editor</a>
            <a href="interacoes.html" class="view-btn"><i class="fas fa-chart-line"></i> Intera√ß√µes</a>
            <a href="trafego_interno.html" class="view-btn"><i class="fas fa-network-wired"></i> Tr√°fego Conex√£oPSR</a>
            <a href="trafego_portal.html" class="view-btn"><i class="fas fa-globe"></i> Tr√°fego Portal</a>
        </div>
    </div>

    <form id="dashboardForm" onsubmit="event.preventDefault(); confirmSave();">
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header"><h2><i class="fas fa-calendar-alt"></i> Tema do M√™s</h2></div>
                <div class="form-group"><label>T√≠tulo:</label><input type="text" id="tema-titulo" placeholder="Ex: Janeiro Branco"></div>
                <div class="form-group"><label>Subt√≠tulo:</label><input type="text" id="tema-subtitulo" placeholder="Ex: Quem cuida da mente, cuida da vida!"></div>
                <div class="form-group"><label>CAPA URL (Fundo):</label><input type="text" id="tema-capa" placeholder="Link da imagem de fundo"></div>
                <div class="form-group"><label>Resumo (Capa):</label><textarea id="tema-resumo" rows="3" placeholder="Texto curto que aparece no topo..."></textarea></div>
                <div class="form-group"><label>Conte√∫do HTML:</label><textarea id="tema-conteudo" rows="6" placeholder="<p>Texto completo...</p>"></textarea></div>
                <div class="cols-2">
                    <div class="form-group"><label>Fonte Nome:</label><input type="text" id="tema-fonte-nome"></div>
                    <div class="form-group"><label>Fonte Link:</label><input type="text" id="tema-fonte-link"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-lightbulb"></i> Partiu Pensar</h2></div>
                <div class="form-group"><label>T√≠tulo:</label><input type="text" id="pp-titulo" placeholder="Ex: Partiu Pensar"></div>
                <div class="form-group"><label>Subt√≠tulo (Categoria):</label><input type="text" id="pp-subtitulo" placeholder="Ex: Filosofia"></div>
                <div class="form-group"><label>Imagem de Fundo URL:</label><input type="text" id="pp-bg" placeholder="Link da imagem (opcional)"></div>
                <div class="form-group"><label>Resumo (Chamada):</label><textarea id="pp-resumo" rows="2" placeholder="Frase curta de impacto..."></textarea></div>
                <div class="form-group"><label>Conte√∫do Completo (HTML):</label><textarea id="pp-conteudo" rows="5" placeholder="<p>Texto da reflex√£o...</p>"></textarea></div>
                <div class="form-group"><label>Fonte / Autor:</label><input type="text" id="pp-fonte" placeholder="Ex: Mario Sergio Cortella"></div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-heartbeat"></i> Bem-Estar</h2></div>
                <div class="form-group"><label>Subt√≠tulo:</label><input type="text" id="saude-subtitulo" placeholder="Ex: Dicas de Ergonomia"></div>
                <div class="form-group"><label>Resumo:</label><textarea id="saude-resumo" rows="3"></textarea></div>
                <div class="form-group"><label>Conte√∫do HTML:</label><textarea id="saude-conteudo" rows="6"></textarea></div>
                <div class="form-group"><label>Link Fonte:</label><input type="text" id="saude-link"></div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-film"></i> Indica A√≠ (Cultura)</h2></div>
                
                <div class="tab-nav">
                    <button type="button" class="tab-btn active" onclick="switchTab('cultura-video', this)">üé• V√≠deo/Filme</button>
                    <button type="button" class="tab-btn" onclick="switchTab('cultura-livro', this)">üìö Livro</button>
                </div>

                <div id="cultura-video" class="tab-content active">
                    <div style="background:#f8f9fa; padding:15px; border-radius:10px; border:1px solid #eee;">
                        <div class="form-group"><label>T√≠tulo:</label><input type="text" id="cultura-0-titulo"></div>
                        <div class="form-group"><label>Link:</label><input type="text" id="cultura-0-link"></div>
                        <div class="form-group"><label>Capa URL:</label><input type="text" id="cultura-0-img"></div>
                        <div class="form-group"><label>Indicado Por:</label><input type="text" id="cultura-0-indicado"></div>
                        <div class="form-group"><label>Sinopse:</label><textarea id="cultura-0-sinopse"></textarea></div>
                    </div>
                </div>

                <div id="cultura-livro" class="tab-content">
                    <div style="background:#f8f9fa; padding:15px; border-radius:10px; border:1px solid #eee;">
                        <div class="form-group"><label>T√≠tulo:</label><input type="text" id="cultura-1-titulo"></div>
                        <div class="form-group"><label>Link:</label><input type="text" id="cultura-1-link"></div>
                        <div class="form-group"><label>Capa URL:</label><input type="text" id="cultura-1-img"></div>
                        <div class="form-group"><label>Indicado Por:</label><input type="text" id="cultura-1-indicado"></div>
                        <div class="form-group"><label>Sinopse:</label><textarea id="cultura-1-sinopse"></textarea></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2><i class="fas fa-user-circle"></i> Al√©m do Crach√°</h2></div>
                <div class="form-group"><label>Nome:</label><input type="text" id="hobby-nome"></div>
                <div class="form-group"><label>Setor/Cargo:</label><input type="text" id="hobby-cargo"></div>
                <div class="form-group"><label>Foto URL:</label><input type="text" id="hobby-foto"></div>
                <div class="form-group"><label>Texto:</label><textarea id="hobby-texto" rows="4"></textarea></div>
                
                <div class="form-group">
                    <label>Tags (3 principais):</label>
                    <div class="tags-grid">
                        <input type="text" id="tag-1" placeholder="Tag 1 (Ex: Caf√©)">
                        <input type="text" id="tag-2" placeholder="Tag 2 (Ex: C√£es)">
                        <input type="text" id="tag-3" placeholder="Tag 3 (Ex: Viagem)">
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-briefcase"></i> Novos Clientes</h2>
                    <button type="button" class="client-remove" onclick="document.getElementById('clientes-list').innerHTML=''; addNewClientRow();" title="Limpar Lista"><i class="fas fa-trash"></i></button>
                </div>
                <div class="cols-2">
                    <div class="form-group"><label>Qtd Resumo:</label><input type="text" id="clientes-qtd"></div>
                    <div class="form-group"><label>Per√≠odo:</label><input type="text" id="clientes-periodo"></div>
                </div>
                <label style="font-size:0.8em; color:#666; margin-top:10px; display:block;">LISTA (Copie e cole do Excel na caixa de texto):</label>
                <div id="clientes-list" style="margin-top:10px;"></div>
                <button type="button" class="btn-add-client" onclick="addNewClientRow()">+ Adicionar Linha</button>
            </div>
        </div>
    </form>

    <div class="actions-bar">
        <button class="btn-action btn-clear" onclick="clearForm()"><i class="fas fa-eraser"></i> Limpar Formul√°rio</button>
        <button class="btn-action btn-save" onclick="confirmSave()"><i class="fas fa-save"></i> PUBLICAR NO SITE</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyBzMvAw9ahEyd-tSYY08HxcMzo9RKf3IFY", authDomain: "jornalpsr-1b8c6.firebaseapp.com", databaseURL: "https://jornalpsr-1b8c6-default-rtdb.firebaseio.com", projectId: "jornalpsr-1b8c6" };
    firebase.initializeApp(firebaseConfig);
    
    let AUTH_TOKEN = null;
    const CONTENT_URL = "https://jornalpsr-1b8c6-default-rtdb.firebaseio.com/content.json";
    const CATEGORIES_MAP = { "A√ßougues": "ü•©", "Restaurantes": "üçΩÔ∏è", "Ind√∫stria": "üè≠", "Transporte": "üöö", "Com√©rcio": "üè™", "Servi√ßos": "üíº", "Outros": "üè¢", "Farm√°cias": "üíä", "E-commerce": "üì¶", "Automotivo": "üöó", "T√™xtil": "üëï" };
    
    // ==========================================
    // CONFIGURA√á√ÉO DE SEGURAN√áA M√ÅXIMA
    // ==========================================
    const ALLOWED_EMAILS = ["marketingpsrimpressao@gmail.com", "rohsantos1@gmail.com"];
    const ONE_WEEK_MS = 7 * 24 * 60 * 60 * 1000; // 7 dias em milissegundos

    firebase.auth().onAuthStateChanged(async user => {
        if (user) {
            // 1. Verifica se o email est√° na lista branca
            if (ALLOWED_EMAILS.includes(user.email)) {
                
                // 2. Verifica Periodicidade (For√ßa Tarefa de Login Semanal)
                const lastVerified = localStorage.getItem('secure_last_login_ts');
                const now = Date.now();

                // Se n√£o tem registro ou se passou de 7 dias
                if (!lastVerified || (now - parseInt(lastVerified) > ONE_WEEK_MS)) {
                    // Sess√£o expirada para verifica√ß√£o de seguran√ßa
                    console.log("Sess√£o de seguran√ßa de 7 dias expirada. Revalidando...");
                    await firebase.auth().signOut();
                    // O reload vai for√ßar o popup de login novamente
                    window.location.reload();
                    return;
                }

                // Se passou nas checagens:
                // Atualiza o timestamp apenas se estiver perto de vencer? 
                // N√£o, mantemos o original para for√ßar a re-valida√ß√£o exata em 7 dias a partir do login inicial.
                // Mas precisamos salvar o timestamp na PRIMEIRA vez que loga (feito no else abaixo).
                
                user.getIdToken().then(token => { 
                    AUTH_TOKEN = token;
                    // Mostra o app e esconde o loading
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('app-content').style.display = 'block';
                    loadContent(); 
                });

            } else {
                // E-mail n√£o autorizado (Hacker ou curioso)
                forceLockdown();
            }
        } else {
            // N√£o logado, inicia fluxo de login
            firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())
                .then((result) => {
                    const email = result.user.email;
                    if (ALLOWED_EMAILS.includes(email)) {
                        // Login bem sucedido e autorizado: Seta o timer de 7 dias
                        localStorage.setItem('secure_last_login_ts', Date.now());
                        window.location.reload(); // Recarrega para aplicar o fluxo limpo
                    } else {
                        forceLockdown();
                    }
                })
                .catch((error) => {
                    console.error(error);
                    alert("Erro na autentica√ß√£o.");
                });
        }
    });

    function forceLockdown() {
        firebase.auth().signOut();
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app-content').style.display = 'none'; // Garante que est√° oculto
        document.getElementById('access-denied').style.display = 'flex'; // Mostra tela de bloqueio
    }

    function logoutAndReload() {
        firebase.auth().signOut().then(() => {
            window.location.reload();
        });
    }

    // ==========================================
    // FIM DA CONFIGURA√á√ÉO DE SEGURAN√áA
    // ==========================================

    // Fun√ß√£o para alternar as abas
    function switchTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function clearForm() {
        if(!confirm("Tem certeza que deseja limpar todo o formul√°rio? Voc√™ perder√° o que n√£o foi salvo.")) return;
        document.querySelectorAll('input, textarea').forEach(el => el.value = '');
        document.getElementById('clientes-list').innerHTML = '';
        addNewClientRow();
    }

    async function loadContent() {
        try {
            const resp = await fetch(CONTENT_URL + "?auth=" + AUTH_TOKEN);
            const data = await resp.json();
            if(!data) return;

            setVal('tema-titulo', data.temaMes?.titulo);
            setVal('tema-subtitulo', data.temaMes?.subtitulo);
            setVal('tema-resumo', data.temaMes?.resumo);
            setVal('tema-conteudo', data.temaMes?.conteudoCompleto);
            setVal('tema-fonte-nome', data.temaMes?.fonte?.texto);
            setVal('tema-fonte-link', data.temaMes?.fonte?.link);
            setVal('tema-capa', data.temaMes?.capaUrl);

            setVal('pp-titulo', data.partiuPensar?.titulo);
            setVal('pp-subtitulo', data.partiuPensar?.subtitulo);
            setVal('pp-bg', data.partiuPensar?.imagemFundo);
            setVal('pp-resumo', data.partiuPensar?.resumo);
            setVal('pp-conteudo', data.partiuPensar?.conteudoCompleto);
            setVal('pp-fonte', data.partiuPensar?.fonte);

            setVal('saude-subtitulo', data.saudeFisica?.subtitulo);
            setVal('saude-resumo', data.saudeFisica?.resumo);
            setVal('saude-conteudo', data.saudeFisica?.conteudoCompleto);
            setVal('saude-link', data.saudeFisica?.fonte?.link);

            if(data.cultura) {
                data.cultura.forEach((item, i) => {
                    if(i>1) return;
                    setVal(`cultura-${i}-titulo`, item.titulo);
                    setVal(`cultura-${i}-link`, item.link);
                    setVal(`cultura-${i}-img`, item.img);
                    setVal(`cultura-${i}-indicado`, item.indicadoPor);
                    setVal(`cultura-${i}-sinopse`, item.sinopse);
                });
            }

            if(data.hobby) {
                setVal('hobby-nome', data.hobby.nome);
                setVal('hobby-cargo', data.hobby.cargo);
                setVal('hobby-foto', data.hobby.foto);
                setVal('hobby-texto', data.hobby.texto);
                let tags = data.hobby.tags || [];
                if (typeof tags === 'string') tags = tags.split(',').map(t=>t.trim());
                setVal('tag-1', tags[0] || '');
                setVal('tag-2', tags[1] || '');
                setVal('tag-3', tags[2] || '');
            }

            if(data.novos_clientes) {
                setVal('clientes-qtd', data.novos_clientes.resumo?.quantidade);
                setVal('clientes-periodo', data.novos_clientes.resumo?.periodo);
                const list = document.getElementById('clientes-list');
                list.innerHTML = '';
                if(data.novos_clientes.lista) {
                    data.novos_clientes.lista.forEach(c => {
                        let catKey = Object.keys(CATEGORIES_MAP).find(k => CATEGORIES_MAP[k] === c.icone) || "Outros";
                        addNewClientRow(catKey, c.nome);
                    });
                } else {
                    addNewClientRow();
                }
            }
        } catch(e) { console.error(e); alert("Erro ao carregar dados."); }
    }

    async function confirmSave() {
        if(!confirm("Tem certeza que deseja publicar as altera√ß√µes?")) return;
        
        let currentData = {};
        try {
            const resp = await fetch(CONTENT_URL + "?auth=" + AUTH_TOKEN);
            currentData = await resp.json() || {};
        } catch(e) {}

        const tagsArray = [getVal('tag-1'), getVal('tag-2'), getVal('tag-3')].filter(t => t.trim() !== "");

        const data = {
            temaMes: {
                titulo: getVal('tema-titulo'),
                subtitulo: getVal('tema-subtitulo'),
                resumo: getVal('tema-resumo'),
                conteudoCompleto: getVal('tema-conteudo'),
                capaUrl: getVal('tema-capa'),
                fonte: { texto: getVal('tema-fonte-nome'), link: getVal('tema-fonte-link') }
            },
            partiuPensar: {
                titulo: getVal('pp-titulo'),
                subtitulo: getVal('pp-subtitulo'),
                imagemFundo: getVal('pp-bg'),
                resumo: getVal('pp-resumo'),
                conteudoCompleto: getVal('pp-conteudo'),
                fonte: getVal('pp-fonte')
            },
            saudeFisica: {
                subtitulo: getVal('saude-subtitulo'),
                resumo: getVal('saude-resumo'),
                conteudoCompleto: getVal('saude-conteudo'),
                fonte: { link: getVal('saude-link'), texto: "Fonte" }
            },
            cultura: [
                { id: "filme_mes", tipo: "video", titulo: getVal('cultura-0-titulo'), link: getVal('cultura-0-link'), img: getVal('cultura-0-img'), indicadoPor: getVal('cultura-0-indicado'), sinopse: getVal('cultura-0-sinopse'), tag: "Indica√ß√£o" },
                { id: "livro_mes", tipo: "livro", titulo: getVal('cultura-1-titulo'), link: getVal('cultura-1-link'), img: getVal('cultura-1-img'), indicadoPor: getVal('cultura-1-indicado'), sinopse: getVal('cultura-1-sinopse'), tag: "Leitura" }
            ],
            hobby: {
                nome: getVal('hobby-nome'),
                cargo: getVal('hobby-cargo'),
                foto: getVal('hobby-foto'),
                texto: getVal('hobby-texto'),
                tags: tagsArray
            },
            receitas: currentData.receitas || [], 
            
            novos_clientes: {
                resumo: { quantidade: getVal('clientes-qtd'), periodo: getVal('clientes-periodo') },
                lista: Array.from(document.querySelectorAll('.client-row')).map(row => ({
                    icone: CATEGORIES_MAP[row.querySelector('select').value] || "üè¢",
                    nome: row.querySelector('input').value,
                    destaque: false, data: ""
                })).filter(c => c.nome)
            },
            desafios: currentData.desafios || [ 
                {id: "hidratacao", emoji: "üíß", titulo: "Hidrata√ß√£o", desc: "Beba 2L de √°gua"},
                {id: "passos", emoji: "üö∂", titulo: "10k Passos", desc: "Caminhe todo dia"},
                {id: "sono", emoji: "üò¥", titulo: "Sono", desc: "Durma 8h"}
            ],
            sustentabilidade: currentData.sustentabilidade || {}
        };

        try {
            await fetch(CONTENT_URL + "?auth=" + AUTH_TOKEN, { method: 'PUT', body: JSON.stringify(data) });
            alert("Conte√∫do publicado com sucesso!");
        } catch(e) { alert("Erro ao salvar: " + e.message); }
    }

    function addNewClientRow(cat="", name="") {
        const div = document.createElement('div'); div.className = 'client-row';
        let options = ''; 
        for(let k in CATEGORIES_MAP) options += `<option value="${k}" ${k===cat?'selected':''}>${k}</option>`;
        div.innerHTML = `<select class="client-select" style="padding:10px; border-radius:8px; border:2px solid #ddd;">${options}</select><div style="display:flex;gap:5px;width:100%"><input type="text" value="${name}" class="client-input"><button type="button" class="client-remove" onclick="this.closest('.client-row').remove()"><i class="fas fa-trash"></i></button></div>`;
        document.getElementById('clientes-list').appendChild(div);
    }

    document.getElementById('clientes-list').addEventListener('paste', e => {
        if(!e.target.classList.contains('client-input')) return;
        const text = (e.clipboardData || window.clipboardData).getData('text');
        if(!text.includes('\n')) return;
        e.preventDefault();
        const lines = text.split(/\r?\n/).filter(l=>l.trim());
        const cat = e.target.closest('.client-row').querySelector('select').value;
        e.target.value = lines[0];
        for(let i=1; i<lines.length; i++) addNewClientRow(cat, lines[i]);
    });

    function getVal(id) { return document.getElementById(id)?.value || ""; }
    function setVal(id, v) { if(document.getElementById(id)) document.getElementById(id).value = v || ""; }
</script>
</body>
</html>
